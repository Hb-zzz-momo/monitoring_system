# Architecture Diagram - 架构图

## 应用程序导航架构 (Application Navigation Architecture)

```
┌─────────────────────────────────────────────────────────────────┐
│                          启动页面流程                              │
│                      (Startup Flow)                              │
└─────────────────────────────────────────────────────────────────┘

                    SplashScreen
                         │
                         ↓
                    LoginScreen
                         │
                         ↓
         ┌───────────────────────────────┐
         │        MainShell              │
         │  (Bottom Navigation Bar)      │
         │  底部导航栏始终可见            │
         └───────────────────────────────┘
                         │
         ┌───────────────┼───────────────┐
         │               │               │
    ┌────▼────┐    ┌────▼────┐    ┌────▼────┐    ┌────▼────┐
    │ Tab 0   │    │ Tab 1   │    │ Tab 2   │    │ Tab 3   │
    │ 3D设备  │    │实时监测 │    │告警/工单│    │  我的   │
    └─────────┘    └─────────┘    └─────────┘    └─────────┘
         │                              │              │
         │                              │              │
         │                              │         ┌────▼──────────┐
         │                              │         │"已绑定设备"   │
         │                              │         │onSwitchTab(0) │
         │                              │         └────┬──────────┘
         │                              │              │
         └──────────────────────────────┴──────────────┘
                         │
                         │ 点击设备卡片
                         │ pushNamed
                         ↓
         ┌───────────────────────────────┐
         │    DeviceDetailShell          │
         │  (全屏，覆盖底部导航栏)       │
         │  (自动显示返回箭头)           │
         └───────────────────────────────┘
                         │
         ┌───────────────┼───────────────┐
         │               │               │
    ┌────▼────┐    ┌────▼────┐    ┌────▼────┐    ┌────▼────┐
    │3D视图   │    │监测总览 │    │  曲线   │    │健康寿命 │
    └─────────┘    └─────────┘    └─────────┘    └─────────┘
```

## 详细Tab结构 (Detailed Tab Structure)

### Tab 0: 3D设备 (3D Device Tab)

```
┌─────────────────────────────────────────────────┐
│  AppBar: "3D设备视图"                            │
│  (无返回箭头 - automaticallyImplyLeading: false) │
├─────────────────────────────────────────────────┤
│                                                 │
│  ┌───────────────────────────────────────────┐ │
│  │     3D 可视化区域                         │ │
│  │  • 深色渐变背景                           │ │
│  │  • 网格效果 (GridPainter)                │ │
│  │  • 可点击组件标签:                       │ │
│  │    ┌──────────┬──────────┬──────────┐   │ │
│  │    │ 主轴承   │  电机    │ 传动轴   │   │ │
│  │    └────┬─────┴──────────┴──────────┘   │ │
│  │         │ onClick                        │ │
│  │         ↓                                │ │
│  │    打开右侧抽屉                          │ │
│  │  • 工具按钮 (重置/爆炸图/全屏)           │ │
│  └───────────────────────────────────────────┘ │
│                                                 │
│  ┌──────────────┬──────────────┐              │
│  │ 温度 42.3℃  │ 电压 220.5V  │              │
│  └──────────────┴──────────────┘              │
│  ┌──────────────┬──────────────┐              │
│  │ 电流 15.2A   │ 功率 3.35kW  │              │
│  └──────────────┴──────────────┘              │
│                                                 │
│  ┌───────────────────────────────────────────┐ │
│  │ 最近告警 (max 2)                          │ │
│  │ ┌─────────────────────────────────────┐  │ │
│  │ │ [!] 部件过温告警      → 点击查看详情 │  │ │
│  │ └─────────────────────────────────────┘  │ │
│  │ ┌─────────────────────────────────────┐  │ │
│  │ │ [!] 电压异常预警      → 点击查看详情 │  │ │
│  │ └─────────────────────────────────────┘  │ │
│  └───────────────────────────────────────────┘ │
│                                                 │
└─────────────────────────────────────────────────┘

      右侧抽屉 (onClick 组件标签) ──────────────┐
                                                 │
    ┌───────────────────────────────────────────▼┐
    │ 主轴承                          [X]          │
    │ 健康等级: 72%                               │
    ├──────────────────────────────────────────────┤
    │ HI (健康度)                                 │
    │ ████████████████░░░░░░░░ 72%               │
    ├──────────────────────────────────────────────┤
    │ RUL (剩余寿命)                              │
    │ 180 天                                      │
    │ 预测区间: 150-210 天                        │
    ├──────────────────────────────────────────────┤
    │ 建议动作                                    │
    │ ✓ 建议在未来30天内安排维护                  │
    │ ✓ 监控温度变化趋势                          │
    │ ✓ 准备备件                                  │
    ├──────────────────────────────────────────────┤
    │ 相关测点                                    │
    │ 温度: 78.5℃                                │
    │ 振动: 2.3 mm/s                             │
    │ 压力: 1.2 MPa                              │
    ├──────────────────────────────────────────────┤
    │ [  查看曲线  ]                              │
    │ [  创建工单  ]                              │
    └──────────────────────────────────────────────┘
```

### Tab 1: 实时监测 (Realtime Tab)

```
┌─────────────────────────────────────────────────┐
│  AppBar: "实时监测"                              │
│  (无返回箭头 - automaticallyImplyLeading: false) │
├─────────────────────────────────────────────────┤
│  ┌───────────────────────────────────────────┐ │
│  │ ● 已连接    延迟: 12 ms                   │ │
│  │ 时间范围: [5s] [30s] [1m] [5m]           │ │
│  └───────────────────────────────────────────┘ │
│                                                 │
│  ┌───────────────────────────────────────────┐ │
│  │ 温度                   Sparkline ▁▂▃▄▅▆  │ │
│  │ 42.3 ℃                                   │ │
│  │ 最大:45.2  最小:38.5  均值:42.1          │ │
│  └───────────────────────────────────────────┘ │
│                                                 │
│  ┌──────────────┬──────────────┐              │
│  │ 电压 220.5V  │ 电流 15.2A   │              │
│  └──────────────┴──────────────┘              │
│  ┌──────────────┬──────────────┐              │
│  │ 功率 3.35kW  │ 电能 125.8kWh│              │
│  └──────────────┴──────────────┘              │
│                                                 │
│  ┌───────────────────────────────────────────┐ │
│  │ 最新事件                                  │ │
│  │ [!] 主轴承温度告警      10分钟前          │ │
│  │ [i] 设备启动完成        1小时前           │ │
│  │ [w] 工单WO-2024-001已创建  2小时前        │ │
│  └───────────────────────────────────────────┘ │
└─────────────────────────────────────────────────┘
```

### Tab 2: 告警/工单 (Alarm/Work Tab)

```
┌─────────────────────────────────────────────────┐
│  AppBar: "告警/工单"                             │
│  (无返回箭头 - automaticallyImplyLeading: false) │
│  ┌─────────────┬─────────────┐                  │
│  │   告警      │   工单      │                  │
│  └─────────────┴─────────────┘                  │
├─────────────────────────────────────────────────┤
│  告警中心 / 工单列表                            │
│  (可筛选、可搜索、可点击查看详情)               │
└─────────────────────────────────────────────────┘
```

### Tab 3: 我的 (Profile Tab)

```
┌─────────────────────────────────────────────────┐
│  AppBar: "我的"                                  │
│  (无返回箭头 - automaticallyImplyLeading: false) │
├─────────────────────────────────────────────────┤
│  ┌───────────────────────────────────────────┐ │
│  │ [D] Demo User                  [退出]     │ │
│  │     demo@example.com                      │ │
│  └───────────────────────────────────────────┘ │
│                                                 │
│  设备管理                                       │
│  ┌───────────────────────────────────────────┐ │
│  │ [📱] 已绑定设备         4台设备    >      │ │
│  │       ↓ onClick                           │ │
│  │   onSwitchTab(0) ← 切换到3D设备Tab       │ │
│  └───────────────────────────────────────────┘ │
│                                                 │
│  通知设置                                       │
│  ┌───────────────────────────────────────────┐ │
│  │ [🔔] 推送通知              [ON/OFF]       │ │
│  └───────────────────────────────────────────┘ │
│                                                 │
│  阈值展示                                       │
│  ┌───────────────────────────────────────────┐ │
│  │ 温度: 75℃  电压: 240V  电流: 20A         │ │
│  └───────────────────────────────────────────┘ │
│                                                 │
│  关于                                           │
│  ┌───────────────────────────────────────────┐ │
│  │ [ℹ️] 版本信息  v1.0.0            >        │ │
│  │ [🔒] 隐私政策                    >        │ │
│  │ [📄] 日志导出                    >        │ │
│  └───────────────────────────────────────────┘ │
└─────────────────────────────────────────────────┘
```

## DeviceDetailShell 结构

```
┌─────────────────────────────────────────────────┐
│  AppBar: [←] "主控设备-01 ●"         [⋮]       │
│  (有返回箭头 - 自动添加)                        │
│  ┌───────┬───────┬───────┬───────────┐         │
│  │3D视图│监测总览│ 曲线  │ 健康寿命  │         │
│  └───────┴───────┴───────┴───────────┘         │
├─────────────────────────────────────────────────┤
│                                                 │
│  Tab内容区域 (根据选中的Tab显示不同内容)       │
│                                                 │
│  • 3D视图: 简化版3D + KPI卡片                  │
│  • 监测总览: KPI网格                           │
│  • 曲线: 实时曲线图 (虚拟数据)                 │
│  • 健康寿命: 健康度 + 寿命 + 部件详情         │
│                                                 │
└─────────────────────────────────────────────────┘
```

### 健康寿命Tab详细结构

```
┌─────────────────────────────────────────────────┐
│  ┌───────────────────────────────────────────┐ │
│  │ 整体健康度                                │ │
│  │ 78%  ✓ 状态良好                          │ │
│  │ ████████████████░░░░░░░░                 │ │
│  └───────────────────────────────────────────┘ │
│                                                 │
│  ┌───────────────────────────────────────────┐ │
│  │ 预期剩余寿命                              │ │
│  │ 240 天                                    │ │
│  │ 预测区间: 200-280 天                      │ │
│  │ 预计到期日: 2024-09-07                    │ │
│  └───────────────────────────────────────────┘ │
│                                                 │
│  部件健康详情                                   │
│  ┌───────────────────────────────────────────┐ │
│  │ 主轴承                          72%       │ │
│  │ ████████████████░░░░░░░░                 │ │
│  │ 剩余寿命: 180天  区间: 150-210天 [详情]  │ │
│  └───────────────────────────────────────────┘ │
│  ┌───────────────────────────────────────────┐ │
│  │ 电机                            85%       │ │
│  │ ████████████████████░░░░                 │ │
│  │ 剩余寿命: 320天  区间: 280-350天 [详情]  │ │
│  └───────────────────────────────────────────┘ │
│                                                 │
│  ┌───────────────────────────────────────────┐ │
│  │ 维护建议                                  │ │
│  │ 💡 建议在未来30天内安排主轴承维护         │ │
│  │ 🌡️ 持续监控温度变化趋势                  │ │
│  │ 📦 准备相关备件                           │ │
│  └───────────────────────────────────────────┘ │
└─────────────────────────────────────────────────┘
```

### 曲线Tab详细结构

```
┌─────────────────────────────────────────────────┐
│  ┌───────────────────────────────────────────┐ │
│  │ 指标: [温度] [电压] [电流] [功率]         │ │
│  │ 部件: [整机 ▼]   ⏸ ⟳ 📷                  │ │
│  └───────────────────────────────────────────┘ │
│                                                 │
│  ┌───────────────────────────────────────────┐ │
│  │ 实时曲线              最近30分钟           │ │
│  │                                           │ │
│  │  │                      ╱╲                │ │
│  │  │    ╱╲              ╱  ╲               │ │
│  │  │  ╱  ╲    ╱╲      ╱    ╲      ╱       │ │
│  │  │╱      ╲╱  ╲    ╱      ╲    ╱        │ │
│  │  │            ╲  ╱        ╲  ╱         │ │
│  │  │             ╲╱          ╲╱          │ │
│  │  └──────────────────────────────────    │ │
│  │                                           │ │
│  │  ▬ 温度  ▬ 电压  ▬ 电流  ▬ 功率          │ │
│  └───────────────────────────────────────────┘ │
│                                                 │
│  ┌───────────────────────────────────────────┐ │
│  │ ▼ 数据点表                                │ │
│  │ 2024-01-10 10:30:00  42.0℃               │ │
│  │ 2024-01-10 10:35:00  42.5℃               │ │
│  │ ...                                       │ │
│  └───────────────────────────────────────────┘ │
└─────────────────────────────────────────────────┘
```

## 关键导航逻辑 (Key Navigation Logic)

### 1. Tab切换 (Tab Switching)
```dart
// MainShell
void _switchToTab(int index) {
  setState(() {
    _currentIndex = index;  // 更新当前Tab索引
  });
}

// ProfileTab中使用
widget.onSwitchTab!(0);  // 切换到Tab 0
```

### 2. 页面推送 (Page Pushing)
```dart
// 从任意位置推送到设备详情
Navigator.pushNamed(
  context,
  AppRoutes.deviceDetail,
  arguments: {
    'deviceId': '1',
    'deviceName': '主控设备-01',
  },
);
```

### 3. 返回导航 (Back Navigation)
```dart
// DeviceDetailShell中的返回箭头
// 自动添加，点击时执行：
Navigator.pop(context);
```

---

**图示说明**:
- `→` 表示用户交互/点击
- `↓` 表示导航流程
- `[按钮]` 表示可点击元素
- `●` 表示在线状态指示器
- `█` 表示进度条/健康度
- `✓` 表示确认/成功
- `[!]` 表示告警
- `[i]` 表示信息
- `[w]` 表示工单

这个架构图完整展示了应用的导航结构和UI组成。
